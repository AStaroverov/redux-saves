var I=Object.defineProperty,Ke=e=>I(e,"__esModule",{value:!0}),Ge=(e,a)=>{Ke(e);for(var n in a)I(e,n,{get:a[n],enumerable:!0})};Ge(exports,{SavesActionType:()=>t,createAddSaveAction:()=>ve,createClearSavesAction:()=>pe,createLoadNextSaveAction:()=>de,createLoadPrevSaveAction:()=>se,createLoadSaveAction:()=>ue,createRemoveSavesAction:()=>Se,createSavesMiddleware:()=>Te,savesReducer:()=>F,savesReducerWrapper:()=>ce});var X="@@REDUX_SAVES@@/setSavesMetadataActionType";function fe(){return{groupSaves:{},currentBranchSaves:{},currentGroupSaves:{}}}function z(e){return{type:X,payload:e}}function F(e=fe(),a){switch(a.type){case X:{let{groupSaves:n,currentBranchSaves:o,currentGroupSaves:v}=a.payload;return{...e,groupSaves:{...e.groupSaves,...n},currentBranchSaves:{...e.currentBranchSaves,...o},currentGroupSaves:{...e.currentGroupSaves,...v}}}default:return e}}var _="@@REDUX-SAVE@@";function h(e){return typeof e=="string"&&e.startsWith(_)}var Ae=0;function O(){return`${_}/save-${Ae++}`}var W=0;function Y(){W+=1}function $(){return`${_}/autosave-${W}`}var j=new Map;function g(e,a){j.set(e,a)}function L(e){return j.get(e)}function U(e,a){return{groupSaveKey:e,snapshot:a}}var E=!0,J,w=new Set;function xe(e){w.add(e),E=!0}function le(e){w.delete(e),E=!0}function V(){return E&&(E=!1,J=Array.from(w)),J}function q(){return new Map}function m(e,a){return e.get(a)}var H=e=>e.size;function B(e,a){e.set(a.groupSaveKey,a)}function Q(e,a){e.delete(a)}function Z(e){e.clear()}function R(e,a,n,o){return{groupKey:e,key:a,prevSaveKey:n,nextSaveKey:o}}function D(e,a,n){let o=c(e,a);o!==void 0&&(o.nextSaveKey=n)}var f=new Map;function c(e,a){return f.get(e).get(a)}function k(e){return Array.from(f.get(e)?.keys()||[])}function ee(e,a){let n=[],o=c(e,a);return o===void 0||(n.push(o.key),o.nextSaveKey!==void 0&&l(e,o.nextSaveKey,v=>(n.push(v.key),v.nextSaveKey)),o.prevSaveKey!==void 0&&l(e,o.prevSaveKey,v=>(n.unshift(v.key),v.prevSaveKey))),n}function P(e){f.has(e.groupKey)||f.set(e.groupKey,new Map),f.get(e.groupKey).set(e.key,e)}function ge(e,a){f.get(e).delete(a)}function C(e,a){let n=c(e,a);if(n.prevSaveKey&&n.nextSaveKey){let o=c(e,n.prevSaveKey),v=c(e,n.nextSaveKey);v.prevSaveKey=o.key,o.nextSaveKey=v.key}ge(e,n.key),K(e)===a&&A(e,n.prevSaveKey)}function oe(e){f.get(e)?.clear()}var re=new Map;function A(e,a){re.set(e,a)}function K(e){return re.get(e)}function l(e,a,n){let o=c(e,a),v;for(;o!==void 0;){v=o;let s=n(o);o=s?c(e,s):void 0}return v}var N=new Map,ae=e=>{le(e),N.delete(e)},te=(e,a)=>{N.has(e)||(xe(e),N.set(e,[])),N.get(e).push(a)},b=Object.freeze({}),ne="__DEFAULT_GROUP_KEY__",t;(function(e){e.SetInitState="@@REDUX_SAVE@@/SetInitState",e.ClearSaves="@@REDUX_SAVE@@/ClearSaves",e.AddSave="@@REDUX_SAVE@@/AddSave",e.RemoveSaves="@@REDUX_SAVE@@/RemoveLastsSaves",e.LoadSave="@@REDUX_SAVE@@/LoadSave",e.LoadPrevSave="@@REDUX_SAVE@@/LoadPrevSave",e.LoadNextSave="@@REDUX_SAVE@@/LoadNextSave",e.LoadPrevSaveDone="@@REDUX_SAVE@@/LoadPrevSaveDone",e.LoadNextSaveDone="@@REDUX_SAVE@@/LoadNextSaveDone"})(t||(t={}));var M=e=>{switch(e){case t.ClearSaves:case t.AddSave:case t.LoadSave:case t.RemoveSaves:case t.LoadPrevSave:case t.LoadNextSave:return!0;default:return!1}};function ve(e){return{type:t.AddSave,payload:{groupKeys:e?.groupKeys,saveKey:e?.saveKey||O()}}}function Se(e){return{type:t.RemoveSaves,payload:e||b}}function pe(e){return{type:t.ClearSaves,payload:e||b}}function ue(e){return{type:t.LoadSave,payload:e}}function se(e){return{type:t.LoadPrevSave,payload:e||b}}function de(e){return{type:t.LoadNextSave,payload:e||b}}function ye(e){return{type:t.LoadPrevSaveDone,payload:e}}function ie(e){return{type:t.LoadNextSaveDone,payload:e}}function ce(e,a){let n=a?e:ne,o=a||e,v=q(),s,G=y=>{if(s&&s.groupSaveKey===y){let p=c(n,y);s=p.prevSaveKey!==void 0?m(v,p.prevSaveKey):void 0}Q(v,y)};return(y,p)=>{if(y===void 0||!M(p.type)){let S=o(y,p);return g(n,L(n)||(s===void 0?!0:s.snapshot!==S)),S}if(te(n,v),p.payload.groupKeys!==void 0&&p.payload.groupKeys.indexOf(n)===-1)return o(y,p);let x=H(v),r=L(n)===!0,d=K(n);if((p.type===t.LoadSave||p.type===t.LoadPrevSave)&&d){if(x===0)return y;if(r&&B(v,U(d,y)),p.type===t.LoadSave&&(s=m(v,p.payload.saveKey)||s,s))return s.snapshot;if(p.type===t.LoadPrevSave){let S=p.payload.count||1;if(l(n,d,u=>(s=m(v,u.key)||s,S--===0?void 0:u.prevSaveKey)),s)return s.snapshot}return y}if(p.type===t.LoadNextSave&&d){if(x===0)return y;let S=p.payload.count||1;return l(n,d,u=>(s=m(v,u.key)||s,S--===0?void 0:u.nextSaveKey)),s?s.snapshot:y}if(p.type===t.RemoveSaves&&d){if(x===0)return y;let{saveKeys:S,exceptSaveKeys:u}=p.payload;return S===void 0&&u===void 0&&G(d),S!==void 0?S.forEach(G):u!==void 0&&v.forEach((i,T)=>{u.indexOf(T)!==-1&&G(T)}),y}return p.type===t.AddSave&&(r||!h(p.payload.saveKey))&&B(v,s=U(p.payload.saveKey,y)),p.type===t.ClearSaves&&(s=void 0,Z(v)),y}}function Te(){return function(a){return n=>o=>{if(!M(o.type))return n(o);let v=o.payload.groupKeys||V();if(v.length===0)return n(o);o.type===t.AddSave&&v.forEach(r=>{let d=L(r),S=K(r),u=S?c(r,S):void 0;if(d)P(R(r,o.payload.saveKey,S)),u!==void 0&&D(r,u.key,o.payload.saveKey),A(r,o.payload.saveKey);else if(u!==void 0){let i=!h(o.payload.saveKey),T=u.prevSaveKey;i&&(P(R(r,o.payload.saveKey,T)),T!==void 0&&D(r,T,o.payload.saveKey),A(r,o.payload.saveKey))}}),(o.type===t.LoadSave||o.type===t.LoadPrevSave)&&(Y(),v.forEach(r=>{if(L(r)===!0){let d=K(r),S=$();P(R(r,S,d)),d!==void 0&&D(r,d,S),A(r,S)}})),V().forEach(ae);let s=n(o);o.type===t.ClearSaves&&v.forEach(r=>{oe(r),A(r,void 0)});let G=new Set;o.type===t.AddSave&&v.forEach(r=>{g(r,!1)}),o.type===t.RemoveSaves&&v.forEach(r=>{let d=K(r);if(d===void 0)return;let{saveKeys:S,exceptSaveKeys:u}=o.payload;S===void 0&&u===void 0&&C(r,d),S!==void 0?S.forEach(i=>{C(r,i)}):u!==void 0&&f.get(r).forEach(i=>{u.indexOf(i.key)!==-1&&C(r,i.key)})}),o.type===t.LoadSave&&v.forEach(r=>{A(r,o.payload.saveKey),g(r,!1)}),o.type===t.LoadPrevSave&&v.forEach(r=>{let d=K(r);if(d===void 0)return;let S=o.payload.count||1,u,i=l(r,d,T=>(u&&(T.nextSaveKey=u),u=T.key,S--===0?void 0:T.prevSaveKey));i.key!==d&&(G.add(r),A(r,i.key)),g(r,!1)}),o.type===t.LoadNextSave&&v.forEach(r=>{let d=K(r);if(d===void 0)return;let S=o.payload.count||1,u=l(r,d,i=>S--===0?void 0:i.nextSaveKey);u.key!==d&&(G.add(r),A(r,u.key))});let y={},p={},x={};return v.forEach(r=>{y[r]=k(r),x[r]=K(r),p[r]=x[r]?ee(r,x[r]):[]}),a.dispatch(z({groupSaves:y,currentBranchSaves:p,currentGroupSaves:x})),G.size>0&&(o.type===t.LoadPrevSave&&a.dispatch(ye({groupKeys:Array.from(G)})),o.type===t.LoadNextSave&&a.dispatch(ie({groupKeys:Array.from(G)}))),s}}}
//# sourceMappingURL=redux-saves.cjs.min.js.map
