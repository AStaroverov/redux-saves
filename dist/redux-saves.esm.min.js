var I="@@REDUX_SAVES@@/setSavesMetadataActionType";function Te(){return{groupSaves:{},currentBranchSaves:{},currentGroupSaves:{}}}function X(e){return{type:I,payload:e}}function z(e=Te(),a){switch(a.type){case I:{let{groupSaves:v,currentBranchSaves:o,currentGroupSaves:n}=a.payload;return{...e,groupSaves:{...e.groupSaves,...v},currentBranchSaves:{...e.currentBranchSaves,...o},currentGroupSaves:{...e.currentGroupSaves,...n}}}default:return e}}var _="@@REDUX-SAVE@@";function h(e){return typeof e=="string"&&e.startsWith(_)}var Ke=0;function F(){return`${_}/save-${Ke++}`}var O=0;function W(){O+=1}function Y(){return`${_}/autosave-${O}`}var $=new Map;function g(e,a){$.set(e,a)}function L(e){return $.get(e)}function U(e,a){return{groupSaveKey:e,snapshot:a}}var E=!0,j,w=new Set;function Ge(e){w.add(e),E=!0}function fe(e){w.delete(e),E=!0}function V(){return E&&(E=!1,j=Array.from(w)),j}function J(){return new Map}function m(e,a){return e.get(a)}var q=e=>e.size;function B(e,a){e.set(a.groupSaveKey,a)}function H(e,a){e.delete(a)}function Q(e){e.clear()}function R(e,a,v,o){return{groupKey:e,key:a,prevSaveKey:v,nextSaveKey:o}}function D(e,a,v){let o=c(e,a);o!==void 0&&(o.nextSaveKey=v)}var f=new Map;function c(e,a){return f.get(e).get(a)}function Z(e){return Array.from(f.get(e)?.keys()||[])}function k(e,a){let v=[],o=c(e,a);return o===void 0||(v.push(o.key),o.nextSaveKey!==void 0&&l(e,o.nextSaveKey,n=>(v.push(n.key),n.nextSaveKey)),o.prevSaveKey!==void 0&&l(e,o.prevSaveKey,n=>(v.unshift(n.key),n.prevSaveKey))),v}function P(e){f.has(e.groupKey)||f.set(e.groupKey,new Map),f.get(e.groupKey).set(e.key,e)}function Ae(e,a){f.get(e).delete(a)}function C(e,a){let v=c(e,a);if(v.prevSaveKey&&v.nextSaveKey){let o=c(e,v.prevSaveKey),n=c(e,v.nextSaveKey);n.prevSaveKey=o.key,o.nextSaveKey=n.key}Ae(e,v.key),K(e)===a&&A(e,v.prevSaveKey)}function ee(e){f.get(e)?.clear()}var oe=new Map;function A(e,a){oe.set(e,a)}function K(e){return oe.get(e)}function l(e,a,v){let o=c(e,a),n;for(;o!==void 0;){n=o;let s=v(o);o=s?c(e,s):void 0}return n}var N=new Map,re=e=>{fe(e),N.delete(e)},ae=(e,a)=>{N.has(e)||(Ge(e),N.set(e,[])),N.get(e).push(a)},b=Object.freeze({}),te="__DEFAULT_GROUP_KEY__",t;(function(e){e.SetInitState="@@REDUX_SAVE@@/SetInitState",e.ClearSaves="@@REDUX_SAVE@@/ClearSaves",e.AddSave="@@REDUX_SAVE@@/AddSave",e.RemoveSaves="@@REDUX_SAVE@@/RemoveLastsSaves",e.LoadSave="@@REDUX_SAVE@@/LoadSave",e.LoadPrevSave="@@REDUX_SAVE@@/LoadPrevSave",e.LoadNextSave="@@REDUX_SAVE@@/LoadNextSave",e.LoadPrevSaveDone="@@REDUX_SAVE@@/LoadPrevSaveDone",e.LoadNextSaveDone="@@REDUX_SAVE@@/LoadNextSaveDone"})(t||(t={}));var M=e=>{switch(e){case t.ClearSaves:case t.AddSave:case t.LoadSave:case t.RemoveSaves:case t.LoadPrevSave:case t.LoadNextSave:return!0;default:return!1}};function ne(e){return{type:t.AddSave,payload:{groupKeys:e?.groupKeys,saveKey:e?.saveKey||F()}}}function ve(e){return{type:t.RemoveSaves,payload:e||b}}function Se(e){return{type:t.ClearSaves,payload:e||b}}function pe(e){return{type:t.LoadSave,payload:e}}function ue(e){return{type:t.LoadPrevSave,payload:e||b}}function se(e){return{type:t.LoadNextSave,payload:e||b}}function de(e){return{type:t.LoadPrevSaveDone,payload:e}}function ye(e){return{type:t.LoadNextSaveDone,payload:e}}function ie(e,a){let v=a?e:te,o=a||e,n=J(),s,G=y=>{if(s&&s.groupSaveKey===y){let p=c(v,y);s=p.prevSaveKey!==void 0?m(n,p.prevSaveKey):void 0}H(n,y)};return(y,p)=>{if(y===void 0||!M(p.type)){let S=o(y,p);return g(v,L(v)||(s===void 0?!0:s.snapshot!==S)),S}if(ae(v,n),p.payload.groupKeys!==void 0&&p.payload.groupKeys.indexOf(v)===-1)return o(y,p);let x=q(n),r=L(v)===!0,d=K(v);if((p.type===t.LoadSave||p.type===t.LoadPrevSave)&&d){if(x===0)return y;if(r&&B(n,U(d,y)),p.type===t.LoadSave&&(s=m(n,p.payload.saveKey)||s,s))return s.snapshot;if(p.type===t.LoadPrevSave){let S=p.payload.count||1;if(l(v,d,u=>(s=m(n,u.key)||s,S--===0?void 0:u.prevSaveKey)),s)return s.snapshot}return y}if(p.type===t.LoadNextSave&&d){if(x===0)return y;let S=p.payload.count||1;return l(v,d,u=>(s=m(n,u.key)||s,S--===0?void 0:u.nextSaveKey)),s?s.snapshot:y}if(p.type===t.RemoveSaves&&d){if(x===0)return y;let{saveKeys:S,exceptSaveKeys:u}=p.payload;return S===void 0&&u===void 0&&G(d),S!==void 0?S.forEach(G):u!==void 0&&n.forEach((i,T)=>{u.indexOf(T)!==-1&&G(T)}),y}return p.type===t.AddSave&&(r||!h(p.payload.saveKey))&&B(n,s=U(p.payload.saveKey,y)),p.type===t.ClearSaves&&(s=void 0,Q(n)),y}}function ce(){return function(a){return v=>o=>{if(!M(o.type))return v(o);let n=o.payload.groupKeys||V();if(n.length===0)return v(o);o.type===t.AddSave&&n.forEach(r=>{let d=L(r),S=K(r),u=S?c(r,S):void 0;if(d)P(R(r,o.payload.saveKey,S)),u!==void 0&&D(r,u.key,o.payload.saveKey),A(r,o.payload.saveKey);else if(u!==void 0){let i=!h(o.payload.saveKey),T=u.prevSaveKey;i&&(P(R(r,o.payload.saveKey,T)),T!==void 0&&D(r,T,o.payload.saveKey),A(r,o.payload.saveKey))}}),(o.type===t.LoadSave||o.type===t.LoadPrevSave)&&(W(),n.forEach(r=>{if(L(r)===!0){let d=K(r),S=Y();P(R(r,S,d)),d!==void 0&&D(r,d,S),A(r,S)}})),V().forEach(re);let s=v(o);o.type===t.ClearSaves&&n.forEach(r=>{ee(r),A(r,void 0)});let G=new Set;o.type===t.AddSave&&n.forEach(r=>{g(r,!1)}),o.type===t.RemoveSaves&&n.forEach(r=>{let d=K(r);if(d===void 0)return;let{saveKeys:S,exceptSaveKeys:u}=o.payload;S===void 0&&u===void 0&&C(r,d),S!==void 0?S.forEach(i=>{C(r,i)}):u!==void 0&&f.get(r).forEach(i=>{u.indexOf(i.key)!==-1&&C(r,i.key)})}),o.type===t.LoadSave&&n.forEach(r=>{A(r,o.payload.saveKey),g(r,!1)}),o.type===t.LoadPrevSave&&n.forEach(r=>{let d=K(r);if(d===void 0)return;let S=o.payload.count||1,u,i=l(r,d,T=>(u&&(T.nextSaveKey=u),u=T.key,S--===0?void 0:T.prevSaveKey));i.key!==d&&(G.add(r),A(r,i.key)),g(r,!1)}),o.type===t.LoadNextSave&&n.forEach(r=>{let d=K(r);if(d===void 0)return;let S=o.payload.count||1,u=l(r,d,i=>S--===0?void 0:i.nextSaveKey);u.key!==d&&(G.add(r),A(r,u.key))});let y={},p={},x={};return n.forEach(r=>{y[r]=Z(r),x[r]=K(r),p[r]=x[r]?k(r,x[r]):[]}),a.dispatch(X({groupSaves:y,currentBranchSaves:p,currentGroupSaves:x})),G.size>0&&(o.type===t.LoadPrevSave&&a.dispatch(de({groupKeys:Array.from(G)})),o.type===t.LoadNextSave&&a.dispatch(ye({groupKeys:Array.from(G)}))),s}}}export{t as SavesActionType,ne as createAddSaveAction,Se as createClearSavesAction,se as createLoadNextSaveAction,ue as createLoadPrevSaveAction,pe as createLoadSaveAction,ve as createRemoveSavesAction,ce as createSavesMiddleware,z as savesReducer,ie as savesReducerWrapper};
//# sourceMappingURL=redux-saves.esm.min.js.map
